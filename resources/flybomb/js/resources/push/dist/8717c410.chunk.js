webpackJsonp([26],{899:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},l=a(600),n=s(l),o=a(783),u=o.Radio.Group,p=o.Form.Item,d=n.default.createClass({displayName:"ValidateTime",getInitialState:function(){return{show:!0}},validateTime:function(e){var t=this;return this.props.getFieldProps(e,{initialValue:t.props.form.getFieldValue("validTime")||"24",rules:[{validator:function(a,s,r){return(s=String(s))?s&&s.match(/^\s/)?void r(new Error("行首不能输入空格")):(s&&(!s.match(/^\d+$/)||s>72)&&t.props.form.setFieldsValue(i({},e,72)),void(s&&(!s.match(/^\d+$/)||s<1)?t.props.form.setFieldsValue(i({},e,1)):r())):void r(new Error("请输入有效时长"))}}]})},render:function(){return n.default.createElement("div",null,n.default.createElement(p,r({},this.props.formItemLayout,{label:"是否离线    "}),n.default.createElement(u,this.props.getFieldProps("offLine",{initialValue:this.props.form.getFieldValue("offLine")}),n.default.createElement(o.Radio,{name:"offLine",value:1},"是"),n.default.createElement(o.Radio,{name:"offLine",value:0},"否"))),this.props.form.getFieldValue("offLine")?n.default.createElement(p,r({className:"valid_time",extra:"  小时"},this.props.formItemLayout,{label:"有效时长    "}),n.default.createElement(o.Input,r({type:"number",min:1,max:72,style:{width:200}},this.validateTime("validTime")))):null)}});e.exports=d},900:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},l=a(600),n=s(l),o=a(783),u=a(777),p=s(u),d=o.Button.Group,c=o.Radio.Group,h=o.Form.Item,m=new Date,f={labelCol:{span:4},wrapperCol:{span:17}};window._cronWeeks=[1];var g=n.default.createClass({displayName:"ValidateTime",getInitialState:function(){return{cronWeek:[1],cronWeek1:!0}},onChange:function(e){this.props.onChangePushTime(e)},selectCronWeek:function(e){var t=this.state.cronWeek,a=t.filter(function(t){return t!==e});a.length===t.length?t.push(e):t=a,t.sort(),window._cronWeeks=t,this.setState(i({cronWeek:t},"cronWeek"+e,!this.state["cronWeek"+e])),this.props.selectCronWeek(t)},componentWillUnmount:function(){this.props.jumpUserGroup||(window._cronWeeks=[1])},selectCronTime:function(){},componentDidMount:function(){var e=p.default.queryString("pushType",window.location.href);if("timing"===e){var t=window._cronWeeks;this.props.selectCronWeek&&this.props.selectCronWeek(t);var a=new Date,s={dateNow:a,cronWeek:t};t.map(function(e){s["cronWeek"+e]=!0}),this.setState(s)}},onSelect:function(){},render:function(){var e=this,t=window.location.href,a=t.split("#"),s=p.default.queryString("pushType",a[1]),i=function(e){return e&&e.getTime()+864e5<=Date.now()},l=["一","二","三","四","五","六","日"],u=l.map(function(t,a){var s=a+1;return n.default.createElement(o.Button,{key:a,onClick:function(){return e.selectCronWeek(s)},type:e.state["cronWeek"+s]?"primary":""},t)}),g=this.state.dateNow,v="timing"===s?n.default.createElement(h,r({},f,{label:"任务定制    "}),n.default.createElement(h,r({className:"timing_push radio_btn time_push_checkbox"},this.props.formItemLayout,{label:"推送周期    "}),n.default.createElement(d,null,u)),n.default.createElement(h,r({style:{paddingTop:10},className:"timing_push"},this.props.formItemLayout,{label:"推送时间    "}),n.default.createElement(o.TimePicker,r({},this.props.getFieldProps("cronTime",{initialValue:g,onChange:this.selectCronTime,validate:[{rules:[{required:!0,type:"date",message:"请选择时间"}],trigger:["onBlur","onChange"]}]}),{placeholder:"选择时间",size:"large"})))):n.default.createElement(h,r({},this.props.formItemLayout,{label:"推送时间    "}),n.default.createElement(c,r({onChange:this.onChange},this.props.getFieldProps("pushTimeType",{initialValue:this.props.pushTimeType,onChange:this.props.changeRadio})),n.default.createElement(o.Radio,{name:"pushTimeType",value:0},"即时"),n.default.createElement(o.Radio,{name:"pushTimeType",value:1},"定时")),1===this.props.pushTimeType?n.default.createElement(h,{className:"display_ib mg0"},n.default.createElement(o.DatePicker,r({disabledDate:i},this.props.getFieldProps("startTime",{initialValue:m,onChange:this.onChange,validate:[{rules:[{required:!0,type:"date",message:"请输入推送时间"},{validator:function(e,t,a){var s=+new Date,i=+new Date(t);t&&s-i>0?a("推送时间不能早于当前时间"):a()}}],trigger:["onBlur","onChange"]}]}),{showTime:!0,format:"yyyy-MM-dd HH:mm:ss"}))):null);return v}});g=o.Form.create()(g),e.exports=g},902:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}var i=a(600),r=s(i),l=a(783),n=r.default.createClass({displayName:"Info",getContainer:function(){return document.getElementById("detailTable")},render:function(){var e=this,t=[{text:"目标数",title:"计划推送的目标数"},{text:"日增用户数",title:"当天首次订阅应用的设备数"},{text:"在线峰值用户数",title:"订阅该应用的设备中，当天同时在线的数量峰值"},{text:"日联网用户数",title:"订阅该应用的设备中，当天有联网行为的设备数总和"},{text:"累计注册用户数",title:"历史累积订阅该应用的设备数，已卸载应用不计入累计用户数中"},{text:"联网数",title:"联网并且与通道形成长链接的设备数"},{text:"到达应用数",title:"PushSDK将消息发送给应用的数量（flyme6中，通知栏消息由pushSDK弹出，此埋点仍保留有上报数据）"},{text:"划掉数",title:"在通知栏中划掉消息的数量。透传消息不统计该项"},{text:"已卸载数",title:"本次推送任务中应用已被卸载的数量，数据上将出现接收数大于展示数。（flyme6固件此应用会被反订阅，在重新订阅前下次推送任务将不朝它推送；flyme6以下固件应用没有被反订阅）"},{text:"有效数",title:"从目标数中去除错误或无效的ID，实际有效的ID数量。筛选包括开关状态，订阅状态，pushid有效性以及其他可以推送状态"},{text:"推送数",title:"Push平台实际下发推送的数量"},{text:"接收数",title:"Push服务接收数，任务有效期内，联网并正常接收到推送消息的数量"},{text:"展示数",title:"客户端从Push服务收到消息，并在通知栏中展示的数量（3.0以下版本SDK，数据统计T+1，3.0以上实时统计。透传消息没有展示数统计）"},{text:"点击数",title:"用户点击消息的数量（3.0以下版本SDK，数据统计T+1，3.0以上实时统计。透传消息没有点击数统计）"},{text:"App ID",title:"应用的唯一标识，客户端订阅推送时使用"},{text:"App Key",title:"客户端身份标识，客户端订阅推送时使用"},{text:"App Secret",title:"服务端身份标识，服务端 SDK 初始化使用"},{text:"点击动作",title:"调起包名不是必填项，如不填，则参数传给本应用"},{text:"推送黑名单",title:"选择黑名单后，本次推送将不会朝这批用户推送"},{text:"定速推送",title:"开启定速推送后，此任务的推送速率将按设置的速率推送。速率不会超过应用最大推送速率"},{text:"定时展示",title:"开启定时展示后，目标用户的展示量将平摊到时间段内"},{text:"任务定制",title:"设置好循环推送的周期后，会在规定的时间点进行推送"}],a=t.map(function(t){var a=e.props.text;return a.indexOf(t.text)>-1?t.title:""});return r.default.createElement("span",null,r.default.createElement(l.Tooltip,{getTooltipContainer:this.getContainer,title:a},r.default.createElement("i",{className:"fs14 color999 fw_n cursor_p anticon anticon-info-circle-o"})),this.props.text)}});e.exports=n},903:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},l=a(600),n=s(l),o=a(783),u=a(776),p=s(u),d=a(777),c=s(d),h=a(785),m=s(h),f=o.Radio.Group,g=o.Form.Item,v={},y={},I=n.default.createClass({displayName:"UserType",getInitialState:function(){return{userTypeGroup:[],userTypeTags:[],tags:{},tagIds:{},visible:!1}},componentWillMount:function(){var e=location.href;e.indexOf("pushType=group")>-1&&(v={})},componentWillReceiveProps:function(){var e=this,t=c.default.queryString("appId",window.location.href);if(this.props.appId&&t!==this.props.appId){this.getTags(t),this.getUserGroup(t);var a=this.props.userType,s=this.props.flymeAuth;1!==a&&3!==a&&6!==a||!s||e.changeRadio({target:{name:"userType",value:2}})}},getTags:function(e){var t=this,a=p.default.appTag,s=this.props.tableDataIndex;a=c.default.makeUrl(a,{appId:e}),m.default.get(a,function(e){var a=e.value,i=a.length,r={},l={},n={};if(s){for(var o=s.userTypeInfo.tagIds||"",u=o.split(","),p=[],d=0;d<i;d++)for(var c=0;c<u.length;c++)a[d].tagId==u[c]&&(p.push(a[d].tagName),l[a[d].tagId]=!l[a[d].tagId],n[a[d].tagName]=!n[a[d].tagName]);p=p.join(","),r.tagIdsName=p,r.tagIdsValue=o}t.setState({userTypeTags:e.value,tags:n,tagIds:l,tagIdsName:r.tagIdsName||null,tagIdsValue:r.tagIdsValue||null}),t.props.form.setFieldsValue({tagIdsName:r.tagIdsName||null,tagIds:r.tagIdsValue||null})})},componentDidMount:function(){var e=c.default.queryString("appId",window.location.href),t=c.default.queryString("deal",window.location.href),a=c.default.queryString("groupId",window.location.href);this.setState({appId:e,pushType:c.default.queryString("pushType",window.location.href)}),(t||a||this.props.personalPush)&&this.getUserGroup(e),this.getTags(e),v={},y={},this.props.tableDataIndex&&this.getUserGroup(e)},getUserGroup:function(e){var t=this,a=p.default.listUserGroup;a=c.default.makeUrl(a,{appId:e}),m.default.get(a,function(e){t.setState({userTypeGroup:e.value.items,isDmp:e.value.isDmp,loadGroup:!0}),t.props.setUserTypeGroup(e.value)})},selectTags:function(e){var t=this.state.tags,a=this.state.tagIds,s=e.target.getAttribute("value"),i=e.target.getAttribute("title");t[i]=!t[i],a[s]=!a[s];var r=[],l=[];for(var n in t)t[n]&&r.push(n);for(var o in a)a[o]&&l.push(o);e.target.className=""===e.target.className?"current":"",this.setState({tags:t,tagIds:a,tagIdsName:r.join(","),tagIdsValue:l.join(",")}),this.props.form.setFieldsValue({tagIdsName:r.join(","),tagIds:l.join(",")}),this.props.changeRadio({target:{name:"tags"}})},delUserGroup:function(e,t){var a=this;this.setState({visible:!0,userGroupName:e,delIcon:!0,userGroupId:t});var s=a.props.form.getFieldValue("userGroupId");s!=t&&setTimeout(function(){a.props.form.setFieldsValue({userGroupId:s})},0)},delOk:function(){var e=this,t=c.default.queryString("appId",window.location.href),a=this,s=p.default.delUserGroup,i=this.state.userGroupId,r=this.props.form.getFieldValue("userGroupId");m.default.post(s,{id:this.state.userGroupId},function(){a.getUserGroup(t),o.message.success("用户群"+e.state.userGroupName+"删除成功"),a.props.clearUserGroup(r,i),a.setState({visible:!1,delIcon:!1})})},changeRadio:function(e){var t=c.default.queryString("appId",window.location.href),a=e.target.name,s=e.target.value;"userType"===a&&(this.setState(i({},"target"+s,this.props.form.getFieldValue("target"+s))),1===s&&this.getUserGroup(t)),this.props.changeRadio(e)},delCancel:function(){this.setState({visible:!1,delIcon:!1})},validate:function(e){var t=this,a=this.props.userType,s=this.props.tableDataIndex,i=null;return this.state.removed||this.props.userType!==(s&&s.userTypeInfo.userType)||(i=s.userFileName),this.props.getFieldProps(e,{onChange:function(){t.props.changeRadio({target:{name:"changeTarget"}})},initialValue:v["target"+a]||i,validate:[{rules:[{required:(a>1&&a<5||6===a)&&!this.state["targetRequired"+a],message:"不能为空"},{validator:function(e,t,a){t&&t.match(/^\s/)&&a(new Error("行首不能输入空格")),a()}}],trigger:["onBlur","onChange"]}],onBlur:function(e){v["target"+a]=e.target.value}})},getUserType:function(){var e=this,t=this.props.userType,a=p.default.uploadUserFile,s=c.default.queryString("appId",window.location.href);a=c.default.makeUrl(a,{pushType:"notice"===this.props.type?0:1,userType:t,appId:s});var l=10;e.props.flymeAuth&&(l=50);var u=[],d=this.props.tableDataIndex,h=v["target"+t];!h&&d&&t==d.userTypeInfo.userType&&(h=d.userFileName);var m=!1;!this.state.removed&&(!this.props.clearUserFile||this.state.clearUserFile)&&h&&h.indexOf(".txt")>-1&&h.indexOf(".txt")===h.length-4&&(u=[{uid:-1,name:h,status:"done",url:""}],m=!0);var f={name:"userFile",data:{},accept:".txt",action:a,defaultFileList:u,beforeUpload:function(t){e.setState({loading:!0});var a=t.type;if(t.size>1048576*l)return o.message.error("文件大小不能超过"+l+"M"),e.setState({loading:!1}),!1;var s="text/plain"===a;return s||(o.message.error("请上传txt格式的文件"),e.setState({loading:!1})),s},headers:{authorization:"authorization-text"},onChange:function(t){var a=e.props.userType;if("removed"===t.file.status){if(e.setState({loading:!1}),t.fileList.length<1){var s,r;e.setState((s={},i(s,"targetDisabled"+a,!1),i(s,"removed",!0),i(s,"targetRequired"+a,!1),s)),e.props.form.setFieldsValue((r={},i(r,"userFilePath"+a,void 0),i(r,"target"+a,void 0),r)),v["target"+a]=null}return void e.props.changeRadio({target:{name:"remove"}})}if("error"===t.file.status&&e.setState({loading:!1}),"done"===t.file.status)if(e.setState({loading:!1}),200==t.file.response.code){var l,n;t.fileList.length>1&&t.fileList.shift(),o.message.success(t.file.name+" 上传成功。"),e.props.form.setFieldsValue((l={},i(l,"userFilePath"+a,t.file.response.value.userFilePath),i(l,"target"+a,t.file.name),l)),y["userFilePath"+a]=t.file.response.value.userFilePath,v["target"+a]=t.file.name,e.setState((n={},i(n,"targetDisabled"+a,!0),i(n,"clearUserFile",!0),i(n,"targetRequired"+a,!0),n)),"group"===e.state.pushType&&e.props.changeRadio({target:{name:"upload"}})}else t.fileList.pop(),o.message.error(t.file.response.message),e.props.form.setFieldsValue({})}};return n.default.createElement("div",{className:"user_type"},n.default.createElement(g,null,n.default.createElement(o.Input,r({disabled:m||this.state["targetDisabled"+t],style:{width:300},placeholder:"多个以;分隔",className:"mb10"},this.validate("target"+t)))),n.default.createElement(o.Upload,r({},this.props.getFieldProps("userFilePath"+t,{initialValue:y["userFilePath"+t]}),{style:{width:200}},f),n.default.createElement(o.Button,{disabled:!!this.state.loading,size:"large",className:"btn_normal_show ",type:"ghost"},"TXT文档批量导入",this.state.loading?n.default.createElement(o.Icon,{type:"loading"}):n.default.createElement("span",null))),n.default.createElement("span",{className:"upload_tips"},"最多不超过",l,"M，UTF-8无BOM格式编码文件，内容以回车键进行分割"))},handleSubmit:function(e,t){this.props.handleSubmit(e,"deal"),window.location.hash=t},changeUserGroupRadio:function(e){this.state.delIcon||this.props.changeRadio(e,"userGroupAuth")},getContainer:function(){return document.getElementById("userGropuList")},render:function(){var e=this,t={display:"block",height:30,position:"relative",lineHeight:1.5},a=c.default.queryString("appId",window.location.href),s=c.default.queryString("timingPushType",window.location.href),i="/user/group/new",l=this.state.userTypeGroup.map(function(r,l){var u=r.permission,p=r.id,d=r.name,h={appId:a,id:p,pushType:e.state.pushType};s&&(h.timingPushType=s);var m=c.default.makeUrl(i,h),f={display:"inline-block"};return f.color=u?"#666":"#f00",n.default.createElement(o.Radio,{permission:u,expression:r.userGroupDesc,label:d,key:l,style:t,name:"userGroupId",value:String(p)},n.default.createElement("div",{style:f},!u&&n.default.createElement(o.Tooltip,{getTooltipContainer:e.getContainer,title:"该用户群有标签无权限"},n.default.createElement("i",{className:"fs14  fw_n cursor_p anticon anticon-info-circle-o permission_info"})),n.default.createElement("span",{className:"ellipsis",style:{width:450,display:"inline-block",verticalAlign:"top"},title:d},d)),n.default.createElement("div",{style:{textAlign:"right",position:"absolute",right:"-10px",display:"inline-block"}},n.default.createElement(o.Tooltip,{title:"编辑用户群"},n.default.createElement("i",{onClick:e.handleSubmit.bind(e,window.event,m),className:"i_edit"})),n.default.createElement(o.Tooltip,{title:"删除用户群"},n.default.createElement("i",{onClick:e.delUserGroup.bind(e,d,p),className:"i_del"}))))}),u=this.state.userTypeTags.map(function(t,a){return n.default.createElement("li",{title:t.tagName,className:e.state.tagIds[t.tagId]?"current":"",value:t.tagId,onClick:e.selectTags,key:a},c.default.getTextOverFlow(t.tagName,10,!0))}),p=e.state.pushType,d={appId:a,currentId:this.props.form.getFieldValue("userGroupId"),pushType:p},h=this.props.groupPush;h&&(d.groupPush=h),s&&(d.timingPushType=s);var m=c.default.makeUrl(i,d),v=this.state.tagIdsName,y=this.state.tagIdsValue,I=this.props.userType,b=c.default.queryString("id",window.location.href)||c.default.queryString("groupId",window.location.href);return n.default.createElement(g,r({},this.props.formItemLayout,{label:"指定用户    "}),n.default.createElement(f,this.props.getFieldProps("userType",{initialValue:I,onChange:this.changeRadio}),"group"===p?null:n.default.createElement(o.Radio,{name:"userType",value:0},"全部用户"),n.default.createElement(o.Radio,{name:"userType",value:1},"用户群"),this.props.personalPush?null:n.default.createElement(o.Radio,{name:"userType",value:2},n.default.createElement("span",null,"PushId")),this.props.personalPush?null:this.props.flymeAuth?n.default.createElement(o.Radio,{name:"userType",value:6},"IMEI"):null,this.props.personalPush||"group"===p?null:this.props.flymeAuth?n.default.createElement(o.Radio,{name:"userType",value:3},"Flyme账户"):null,this.props.personalPush?null:n.default.createElement(o.Radio,{name:"userType",value:4},"别名"),this.props.personalPush?null:n.default.createElement(o.Radio,{name:"userType",value:5},"标签")),1===I?n.default.createElement("div",{className:"user_type",id:"userGropuList"},l.length>0?n.default.createElement(g,null,n.default.createElement(f,r({value:this.props.form.getFieldValue("userGroupId"),className:"mb10",style:{width:"100%"}},this.props.getFieldProps("userGroupId",{initialValue:b,onChange:this.changeUserGroupRadio,validate:[{rules:[{required:!0,message:"请选择用户群"},{validator:function(e,t,a){"null"!==t&&"undefined"!==t||a(new Error("请选择用户群")),a()}}]}]})),l)):this.state.loadGroup?n.default.createElement("div",{className:"color_error"},"无用户群"):n.default.createElement("div",null,"数据拉取中..."),n.default.createElement(o.Button,{onClick:this.handleSubmit.bind(this,window.event,m),className:"color_bdc  ",type:"ghost",size:"large"},"添加群组")):null,2===I||3===I||4===I||6===I?this.getUserType():null,5===I?n.default.createElement("div",{className:"user_type",style:{width:600}},u.length>0?n.default.createElement("div",null,n.default.createElement(f,r({style:{width:"100%"}},this.props.getFieldProps("scope",{initialValue:this.props.scope,onChange:this.props.changeRadio})),n.default.createElement(o.Radio,{name:"scope",value:0},"并集"),n.default.createElement(o.Radio,{name:"scope",value:1},"交集")),n.default.createElement(g,null,n.default.createElement(o.Input,r({style:{width:300},disabled:!0,title:this.props.form.getFieldValue("tagIdsName"),placeholder:"选择标签"},this.props.getFieldProps("tagIdsName",{initialValue:v,rules:[{required:!0,message:"请选择标签"}]})))),n.default.createElement("div",{style:{display:"none "}},n.default.createElement(g,null,n.default.createElement(o.Input,r({hidden:!0,style:{width:300},placeholder:"选择标签"},this.props.getFieldProps("tagIds",{initialValue:y}))))),n.default.createElement("ul",{className:"tag_list"},u)):n.default.createElement("div",{className:"color_error"},"无标签")):null,n.default.createElement(o.Modal,{title:"系统提示",visible:e.state.visible,onOk:e.delOk,onCancel:e.delCancel},n.default.createElement("p",null,"删除用户群：",e.state.userGroupName,"?")))}});e.exports=I},904:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},l=a(600),n=s(l),o=a(783),u=a(902),p=s(u),d=o.Radio.Group,c=o.Form.Item,h=n.default.createClass({displayName:"AdvanceSetting",getInitialState:function(){return{display:"none",selectBlack:[],errorTips:"",startTimeStatus:"success",endTimeStatus:"success",noticeImgUrl:this.props.noticeImgUrl}},showAdvance:function(){this.props.showAdvance()},checkBoxChange:function(e){var t=e.target.checked,a=e.target.value;this.props.form.setFieldsValue(i({},a,t?1:0)),this.props.changeRadio(e)},changeStart:function(e){this.props.form.setFieldsValue({fixStartDisplayTime:e})},changeEnd:function(e){this.props.form.setFieldsValue({fixEndDisplayTime:e})},validateStartTime:function(e){var t=this,a=this.props.tableDataIndex;return this.props.getFieldProps(e,{initialValue:a&&a.advanceInfo.fixStartDisplayTime?new Date(a.advanceInfo.fixStartDisplayTime):this.props.form.getFieldValue("startTime")||new Date,onChange:function(e){var a=+new Date(e),s=t.props.form.getFieldValue("fixEndDisplayTime"),i="none",r="",l="success",n="success";a&&s&&a>s&&(r="结束时间不能早于开始时间",l="error",n="error",i=""),a||(r="请选择开始时间",i="",l="error"),s||(r="请选择结束时间",i="",n="error"),t.setState({startTimeStatus:l,endTimeStatus:n,display:i,errorTips:r})}})},validateEndTime:function(e){var t=this,a=this.props.tableDataIndex;return this.props.getFieldProps(e,{initialValue:a&&a.advanceInfo.fixEndDisplayTime?new Date(a.advanceInfo.fixEndDisplayTime):this.props.form.getFieldValue("startTime")||new Date,onChange:function(e){var a=+new Date(e),s=t.props.form.getFieldValue("fixStartDisplayTime"),i="none",r="",l="success",n="success";s&&a&&a<s&&(r="结束时间不能早于开始时间",l="error",n="error",i=""),s||(r="请选择开始时间",i="",l="error"),a||(r="请选择结束时间",i="",n="error"),t.setState({startTimeStatus:l,endTimeStatus:n,display:i,errorTips:r})}})},validateFixSpeedRate:function(e){var t=this,a=t.props.limitRate;return this.props.getFieldProps(e,{validate:[{rules:[{validator:function(e,t,s){t?t&&!String(t).match(/^[1-9]+[0-9]*$/)?s(new Error("请输入正整数")):t&&t>a?s(new Error("推送速率被设置为不能大于"+a)):s():s(new Error("请输入推送速率"))}}],trigger:["onBlur","onChange"]}]})},componentDidMount:function(){var e=this.props.tableDataIndex,t=[];e&&(t=e.advanceInfo.blackId,t=t.split(","),this.setState({selectBlack:t}))},changeBlack:function(e,t){var a=e.target.checked,s=this.state.selectBlack;a?s.push(e.target.name):s=s.filter(function(t){return t!==e.target.name}),this.setState({selectBlack:s});var i=this.props.blackList;i.map(function(a,s){s===t&&(i[s].choose=e.target.checked)}),this.props.changeBlack(i,t)},changeRadioBlack:function(e){var t=this.state.selectBlack,a=void 0;1!==t.length||t[0]||(a="black"),this.props.changeRadio(e,a)},render:function(){var e=this,t=this.props.blackList,a=this.state.selectBlack,s=t.map(function(t,s){var i=t.choose;if(a.length){i=!1;for(var l=0;l<a.length;l++){var u=a[l];u===String(t.blackId)&&(i=!0)}}return n.default.createElement(c,{className:"mg0",key:s},n.default.createElement("label",null,n.default.createElement(o.Checkbox,r({data:t,name:String(t.blackId),title:t.blackName,checked:i},e.props.getFieldProps("blackId"+t.blackId,{initialValue:i,onChange:function(t){e.changeBlack(t,s)}}))),t.blackName,n.default.createElement("span",{title:t.title,className:"pl10"},"数量：",t.blackNum)))});t.length||(s=n.default.createElement("span",{className:"color_error "},"无黑名单"));var i=this.props.vibrate,l=this.props.sound,u=this.props.lights,h=function(t){var a=e.props.form.getFieldValue("startTime"),s=Date.now();return a&&(s=a),t&&t.getTime()+864e5<=s};return n.default.createElement("div",null,!this.props.personalPush&&n.default.createElement(c,r({className:"border_top advance_toggle"},this.props.formItemLayout,{label:"高级设置   "}),n.default.createElement(o.Icon,{onClick:this.showAdvance,style:{fontSize:12,paddingTop:13},type:this.props.showAdvanceStatus?"cross":"down"})),n.default.createElement("div",{style:{display:this.props.showAdvanceStatus?"":"none"}},!this.props.personalPush&&n.default.createElement(c,r({className:"black_notice"},this.props.formItemLayout,{label:n.default.createElement(p.default,{text:"定速推送　"})}),n.default.createElement(d,this.props.getFieldProps("fixSpeed",{initialValue:this.props.fixSpeed,onChange:this.props.changeRadio}),n.default.createElement(o.Radio,{name:"fixSpeed",value:0},"关闭"),n.default.createElement(o.Radio,{name:"fixSpeed",value:1},"开启")),1===this.props.fixSpeed||this.props.form.getFieldValue("fixSpeed")?n.default.createElement(c,{className:"fix_speed_rate"},n.default.createElement(o.Input,r({style:{width:100}},this.validateFixSpeedRate("fixSpeedRate"))),n.default.createElement("span",{className:"pl10"},"条/秒")):null),this.props.personalPush||"notice"!==this.props.type?null:n.default.createElement("div",null,n.default.createElement(c,r({className:"black_notice"},this.props.formItemLayout,{label:n.default.createElement(p.default,{text:"定时展示　"})}),n.default.createElement(d,this.props.getFieldProps("fixDisplay",{initialValue:this.props.fixDisplay,onChange:this.props.changeRadio}),n.default.createElement(o.Radio,{name:"fixDisplay",value:0},"关闭"),n.default.createElement(o.Radio,{name:"fixDisplay",value:1},"开启")),1===this.props.fixDisplay?n.default.createElement("div",null,n.default.createElement(c,{validateStatus:this.state.startTimeStatus,className:"display_ib va_t mg0"},n.default.createElement(o.DatePicker,r({disabledDate:h,onOk:this.changeStart,showTime:!0},this.validateStartTime("fixStartDisplayTime"),{placeholder:"开始时间",format:"yyyy-MM-dd HH:mm:ss"}))),n.default.createElement("span",{className:"pl10 pr10"},"至"),n.default.createElement(c,{validateStatus:this.state.endTimeStatus,className:"display_ib va_t mg0"},n.default.createElement(o.DatePicker,r({disabledDate:h},this.validateEndTime("fixEndDisplayTime"),{placeholder:"结束时间",onOk:this.changeEnd,showTime:!0,format:"yyyy-MM-dd HH:mm:ss"}))),n.default.createElement("span",{style:{display:this.state.display},className:"color_error pl10"},this.state.errorTips)):null),this.props.msgCacheStatus?n.default.createElement(c,r({},this.props.formItemLayout,{label:"消息缓存    "}),n.default.createElement(d,this.props.getFieldProps("msgCache",{initialValue:this.props.msgCache,onChange:this.props.changeRadio}),n.default.createElement(o.Radio,{name:"msgCache",value:0},"关闭"),n.default.createElement(o.Radio,{name:"msgCache",value:1},"开启"))):null,n.default.createElement(c,r({},this.props.formItemLayout,{label:"通知栏悬浮窗    "}),n.default.createElement(d,this.props.getFieldProps("suspend",{initialValue:this.props.suspend,onChange:this.props.changeRadio}),n.default.createElement(o.Radio,{name:"suspend",value:1},"显示"),n.default.createElement(o.Radio,{name:"suspend",value:0},"不显示"))),n.default.createElement(c,r({},this.props.formItemLayout,{label:"清除通知栏    "}),n.default.createElement(d,this.props.getFieldProps("clearNoticeBar",{initialValue:this.props.clearNoticeBar,onChange:this.props.changeRadio}),n.default.createElement(o.Radio,{name:"clearNoticeBar",value:1},"可清除"),n.default.createElement(o.Radio,{name:"clearNoticeBar",value:0},"不可清除"))),n.default.createElement(c,r({},this.props.formItemLayout,{label:"通知提醒类型    "}),n.default.createElement("label",{className:"mr10"},n.default.createElement(o.Checkbox,r({className:"mr10"},this.props.getFieldProps("vibrate",{value:i}),{value:"vibrate",onChange:this.checkBoxChange,checked:!!i})),"震动"),n.default.createElement("label",{className:"mr10"},n.default.createElement(o.Checkbox,r({className:"mr10"},this.props.getFieldProps("lights",{value:u}),{value:"lights",onChange:this.checkBoxChange,checked:!!u})),"闪灯"),n.default.createElement("label",null,n.default.createElement(o.Checkbox,r({className:"mr10"},this.props.getFieldProps("sound",{value:l}),{value:"sound",onChange:this.checkBoxChange,checked:!!l})),"声音"))),n.default.createElement(c,r({className:"black_notice"},this.props.formItemLayout,{label:n.default.createElement(p.default,{text:"推送黑名单　　"})}),n.default.createElement(d,this.props.getFieldProps("black",{initialValue:this.props.black,onChange:this.changeRadioBlack}),n.default.createElement(o.Radio,{name:"black",value:1},"使用"),n.default.createElement(o.Radio,{name:"black",value:0},"禁用"))),1===this.props.form.getFieldValue("black")&&n.default.createElement("div",{className:"user_type user_type_black"},s,n.default.createElement("span",{className:"color_error",style:{display:this.props.displayBlackList}},"请选择黑名单"))))}});e.exports=h},907:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=a(600),l=s(r),n=a(783),o=a(777),u=s(o),p=a(908),d=s(p),c=a(909),h=s(c),m={labelCol:{span:6},wrapperCol:{span:18}},f=l.default.createClass({displayName:"PushModal",getInitialState:function(){return{popoverVisible:!1}},componentDidMount:function(){document.querySelector("#prepush")&&(document.querySelector("#prepush").classList="prepush_position")},render:function(){var e=this.props.form.getFieldValue("startTime"),t=this.props.form.getFieldValue("noticeExpandType"),a="　";0===t&&(a="标准"),1===t&&(a=l.default.createElement("div",null,"文本",l.default.createElement("div",{className:"break_word lh15 mt5 mb5 pr40"},this.props.noticeExpandContent))),2===t&&(a=l.default.createElement("div",null,"大图",l.default.createElement("div",{className:"break_word lh15 mt5 mb5 pr40"},l.default.createElement("img",{width:"225",height:"144",src:window.bigImageFilePathJson.noticeExpandImgUrl||this.props.form.getFieldValue("noticeExpandImgUrl")})))),3===t&&(a="ACT文件");var s=this.props.form.getFieldValue("clickType"),r="　";0===s&&(r="打开应用"),1===s&&(r="打开应用页面"),2===s&&(r="打开URI页面"),3===s&&(r="应用客户端自定义");var o=this.props.form.getFieldValue("clickPackage"),p=this.props.form.getFieldValue("userType");2===p&&this.props.personalPush&&(p=6);var c="　";if(0===p&&(c="全部用户"),1===p){c="用户群";var f=this.props.userGroupName;f&&(c+="("+f+")")}2===p&&(c="PushId"),3===p&&(c="Flyme账户"),4===p&&(c="别名"),5===p&&(c="标签"),6===p&&(c="IMEI");var g="　",v=[],y="";if(this.props.requestData){var I=this.props.requestData.advanceInfo.notificationType,b=this.props.requestData.clickTypeInfo,T={},E=[];for(var w in I)I[w]&&("vibrate"===w&&E.push("震动"),"lights"===w&&E.push("闪灯"),"sound"===w&&E.push("声音"));if(g=E.join("+"),0===E.length&&(g="无"),b){if(T=b.parameters,1==s||2==s||3==s){var S=b.activity||b.url||b.customAttribute||"";1===s&&(S="页面地址："+S),v.push(l.default.createElement("div",{className:"break_word",key:S},S))}if(2!=s&&3!=s)for(var k in T)"undefined"!=k&&""!=k&&v.push(l.default.createElement("div",{key:k},l.default.createElement("p",null,"参数：",k.trim()),l.default.createElement("p",{className:"break_word"},"值：",String(T[k]).trim())))}y=document.getElementById("userName").innerHTML}var N=[];this.props.distinctTitle&&(N=this.props.distinctTitle.map(function(e,t){return l.default.createElement("div",{key:t},e)}));var F=this.props.form.getFieldValue("fixStartDisplayTime"),P=this.props.form.getFieldValue("fixEndDisplayTime");F=F?u.default.dateFormat("yyyy-MM-dd hh:mm:ss",F):null,P=P?u.default.dateFormat("yyyy-MM-dd hh:mm:ss",P):null;var x=P&&F?F+" 至 "+P:"",D="notice"===this.props.type?"推送通知":"透传消息",C=this.props.listSceneTag,V=this.props.cronWeek,R=this.props.form.getFieldValue("cronTime");R&&"object"===("undefined"==typeof R?"undefined":i(R))&&(R=u.default.dateFormat("hh:mm:ss",R));var _={formItemLayout:m,appName:this.props.appName,noticeBarType:this.props.form.getFieldValue("noticeBarType"),noticeBarImgUrl:window.smallImageFilePathJson.noticeBarImgUrl||this.props.form.getFieldValue("noticeBarImgUrl"),title:this.props.form.getFieldValue("title"),content:this.props.form.getFieldValue("content"),noticeExpandTypeText:a,clickTypeText:r,clickPackage:o,startTime:e,offLine:this.props.form.getFieldValue("offLine"),validTime:this.props.form.getFieldValue("validTime"),userTypeText:c,listSceneTag:C,distinct:this.props.form.getFieldValue("distinct"),fixSpeed:this.props.form.getFieldValue("fixSpeed"),fixSpeedRate:this.props.form.getFieldValue("fixSpeedRate"),fixDisplay:this.props.form.getFieldValue("fixDisplay"),fixDisplayTime:x,msgCache:this.props.form.getFieldValue("msgCache"),msgCacheStatus:this.props.msgCacheStatus,suspend:this.props.form.getFieldValue("suspend"),clearNoticeBar:this.props.form.getFieldValue("clearNoticeBar"),notificationTypeText:g,noticeImgUrl:this.props.noticeImgUrl,pushType:"notice"===this.props.type?0:1,clickTypeInfoText:v,userName:y,articleLength:this.props.form.getFieldValue("articleLength"),freshnessNew:this.props.form.getFieldValue("freshnessNew"),distinctTitle:N,tagIdsName:this.props.form.getFieldValue("tagIdsName"),userGroupDesc:1===p?this.props.userGroupDesc:null,
scopeDesc:0==this.props.form.getFieldValue("scope")?"并集":"交集",black:this.props.form.getFieldValue("black"),blackList:this.props.blackList,cronTime:R,cronWeek:V,listMaterial:this.props.listMaterial,pushPercent:this.props.pushPercent},G=l.default.createElement(h.default,{submiting:this.props.submiting,handleOk:this.props.handleOk,type:this.props.type,personalPush:this.props.personalPush,requestData:this.props.requestData,handleCancel:this.props.handleCancel,visible:this.props.visible,pushReviewNumber:this.props.pushReviewNumber,popoverVisible:this.state.popoverVisible});return l.default.createElement(n.Modal,{footer:G,width:700,onCancel:this.props.handleCancel,title:D,visible:this.props.visible},l.default.createElement(d.default,{pushDetailData:_,personalPush:this.props.personalPush}))}});e.exports=f},909:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=a(600),l=s(r),n=a(783),o=a(776),u=s(o),p=a(777),d=s(p),c=a(785),h=s(c),m=l.default.createClass({displayName:"Distinct",getInitialState:function(){var e=window.location.href,t=e.split("#"),a=d.default.queryString("pushType",t[1]);return{pushType:a,values:null,popoverVisible:!1}},handleSave:function(){var e=this.state.pushType,t=this;if(this.props.visible)return"timing"===e?void this.props.handleOk():void this.props.handleSubmit(null,"group",function(e){t.props.setTableData(e)})},handleVisibleChange:function(e){var t=this;this.props.groupPush?this.props.handleSubmit(null,"group",function(a){var s=t.props.addPushData;a.pushTimeInfo=s.pushTimeInfo,a.userTypeInfo=s.userTypeInfo,t.setState({values:a,popoverVisible:e})}):t.setState({popoverVisible:e})},pushReview:function(){var e=document.querySelector("#pushId"+this.props.type).value,t=this.props.requestData,a="notice"===this.props.type?0:1;if(t.pushId=e.replace(/^\s+/,"").replace(/\s+$/,""),!t.pushId)return n.message.error("请输入PushId");var s={};1===a&&(s={appId:t.appId,pushId:t.pushId,title:t.title,content:t.content,pushTimeInfo:{offLine:t.pushTimeInfo.offLine,validTime:t.pushTimeInfo.validTime}},t=s);var i={pushType:a,appId:t.appId,json:JSON.stringify(t)};h.default.post(u.default.pushReview,i,function(){n.message.success("预推成功")})},render:function(){var e,t,a,s=this.state.pushType,r=l.default.createElement("div",null,l.default.createElement(n.Row,{style:{height:36,lineHeight:"33px"}},l.default.createElement(n.Col,{className:"mr10 fs16",span:"5"},"预推测试"),l.default.createElement(n.Col,{className:"mr10",span:"11"},l.default.createElement(n.Input,{id:"pushId"+this.props.type,placeholder:"输入PushId"})),l.default.createElement(n.Col,{span:"6"},l.default.createElement(n.Button,{className:"w_80",type:"primary",onClick:this.pushReview,size:"large"},"预推"))));return l.default.createElement("div",{style:{textAlign:"center"}},this.props.groupPush||this.props.personalPush?null:l.default.createElement("p",{key:"p",className:"push_review_num"},"预计推送人数",l.default.createElement("span",{className:"num"},this.props.pushReviewNumber)),this.props.personalPush?null:l.default.createElement(n.Popover,(e={overlayClassName:"prepush_position",key:"popover",placement:"topLeft"},i(e,"key","test"),i(e,"content",r),i(e,"trigger","click"),i(e,"visible",this.state.popoverVisible),i(e,"onVisibleChange",this.handleVisibleChange),e),l.default.createElement(n.Button,{type:"ghost",className:"color_bdc",size:"large"},"预推测试")),this.props.groupPush||"timing"===s?l.default.createElement(n.Button,(t={key:"button"},i(t,"key","submit"),i(t,"type","primary"),i(t,"size","large"),i(t,"style",{marginLeft:8}),i(t,"onClick",this.handleSave),t),"保存",this.props.submiting?l.default.createElement(n.Icon,{type:"loading"}):l.default.createElement("span",null)):l.default.createElement(n.Button,(a={key:"button"},i(a,"key","submit"),i(a,"type","primary"),i(a,"size","large"),i(a,"style",{marginLeft:8}),i(a,"onClick",this.props.handleOk),a),"推送",this.props.submiting?l.default.createElement(n.Icon,{type:"loading"}):l.default.createElement("span",null)))}});e.exports=m},910:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},r=a(600),l=s(r),n=a(783),o=a(776),u=s(o),p=a(777),d=s(p),c=a(785),h=s(c),m=n.Radio.Group,f=n.Form.Item,g=l.default.createClass({displayName:"Distinct",getInitialState:function(){return{listData:[],distinctId:{}}},changeRadio:function(e){var t=e.target.value;1===t?this.listEffectivePushTask():this.setState({distinctId:{}}),this.props.changeRadio(e)},changeCheckbox:function(e){var t=this.state.distinctId,a=this.state.listData,s=e.target.checked,i=e.target.name;t[i]=!!s,this.setState({distinctId:t});var r=[],l=[];for(var n in t)if(t[n]){r.push(n);for(var o in a)n==a[o].id&&l.push(n+"  "+a[o].title)}this.setState({displayDistinct:r.length>0?"none":""}),this.props.changeCheckbox(r,l)},componentWillReceiveProps:function(){var e=d.default.queryString("deal",window.location.href),t=d.default.queryString("appId",window.location.href);(this.props.appId&&t!==this.props.appId||e&&1===this.props.distinct&&t!==this.props.appId)&&this.listEffectivePushTask()},componentDidMount:function(){var e=this,t=this.props.copyTaskId,a="";t&&this.listEffectivePushTask(t,function(t){for(var s={},i=[],r=0;r<t.length;r++)if(t[r].choose){var l=t[r].id;s["distinctId"+l]=l,s.displayDistinct="none",i.push(l)}e.props.form.setFieldsValue(s),e.props.changeCheckbox(i,a)})},listEffectivePushTask:function(e,t){var a=d.default.queryString("appId",window.location.href),s=this,i=u.default.listEffectivePushTask,r={appId:a,pushType:"notice"===this.props.pushType?0:1};e&&(r.copyTaskId=e),i=d.default.makeUrl(i,r),h.default.get(i,function(e){var a=e.value,i=[],r=[];a.map(function(e){e.choose?i.push(e):r.push(e)});var l=i.concat(r);s.setState({listData:l,loaded:!0}),t&&t(a)})},render:function(){var e=this,t=this.state.listData,a=t.map(function(t,a){var s=e.props.form.getFieldValue("distinctId"+t.id);return l.default.createElement(f,{className:"mg0",key:a},l.default.createElement("label",null,l.default.createElement(n.Checkbox,i({name:String(t.id),title:t.title,checked:!!s},e.props.getFieldProps("distinctId"+t.id,{onChange:e.changeCheckbox}))),t.id,l.default.createElement("span",{title:t.title,className:"distinct_title pl10"},t.title)))});return 0===t.length&&this.state.loaded&&(a=l.default.createElement("span",{className:"color_error"},"无去重列表 ")),l.default.createElement(f,i({},this.props.formItemLayout,{label:"消息去重    "}),l.default.createElement(m,this.props.getFieldProps("distinct",{initialValue:this.props.distinct,onChange:this.changeRadio}),l.default.createElement(n.Radio,{name:"distinct",value:0},"无"),l.default.createElement(n.Radio,{name:"distinct",value:1},"去重")),1===this.props.distinct?l.default.createElement("div",{className:"user_type user_type_distinct"},a,l.default.createElement("span",{className:"color_error",style:{display:this.state.displayDistinct||this.props.displayDistinct}},"请选择去重任务")):null)}});e.exports=g},1547:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},l=a(600),n=s(l),o=a(783),u=a(800),p=s(u),d=a(776),c=s(d),h=a(785),m=s(h),f=a(777),g=s(f),v=a(899),y=s(v),I=a(900),b=s(I),T=a(903),E=s(T),w=a(907),S=s(w),k=a(910),N=s(k),F=a(909),P=s(F),x=a(904),D=s(x),C=a(801),V=s(C),R=o.Select.Option,_=o.Form.Item;window._userGroupDesc=null,window._userGroupName=null,window.vedioFilePathJson={},window.smallImageFilePathJson={},window.bigImageFilePathJson={};var G=V.default.createActions(["notice"]),U=V.default.createStore({listenables:[G],jsonData:null}),L={labelCol:{span:4},wrapperCol:{span:20}},B=n.default.createClass({displayName:"AddAppTask",getInitialState:function(){return{listMaterial:[],listSceneTag:[],scheneTagsName:"无",percentNum:0,offLine:1,displayBlackList:"none",blackList:[],onlyWifi:1,materialIds:[],distinctId:[],displayDistinct:"none",scope:0,userType:1,distinct:0,fixSpeed:0,msgCache:0,netType:0,fixDisplay:0,suspend:1,startTimeStatus:"success",endTimeStatus:"success",pushTimeStatus:"success",popoverVisible:!1,clearNoticeBar:1,smalllayerDisplay:"none",biglayerDisplay:"none",visible:!1,pushReviewNumber:"...",toggleStatus:!1,showAdvanceStatus:!1,pushTimeType:0,distinctTitle:[]}},delParams:function(e,t){for(var a in t)delete e[a]},handleOk:function(){var e=this,t=g.default.queryString("appId",window.location.href),a={appId:t,json:JSON.stringify(this.state.requestData)},s=this.state.pushReviewNumber;return"0"===s?void o.message.error("预计推送人数为0，不可以创建推送任务"):void(this.state.submiting||(this.setState({submiting:!0}),m.default.post(c.default.addPersonalizeNotice,a,function(){o.message.success("提交成功"),window.location.hash="/data/push/record?appId="+t},function(){e.setState({submiting:!1})})))},showAdvance:function(){this.setState({showAdvanceStatus:!this.state.showAdvanceStatus})},validatePushPercent:function(e){var t=this.props.form,a=t.getFieldProps,s=t.validateFields,r=this;return a(e,{validate:[{rules:[{validator:function(t,a,l){String(a).indexOf(".")>-1&&(a=Math.ceil(a),r.props.form.setFieldsValue(i({},e,a)));var n=r.state.pushReviewNumber;if(n=n.split(","),n=n.join(""),"..."!==n){var o=Math.ceil(n*a/100);o=String(o),o=o.split("");for(var u=o.length,p=u-1;p>=0;p--)u-1-p&&(u-1-p)%3===0&&u-1!==p&&(o[p]+=",");a&&r.setState({percentNum:o})}a&&a>100&&(r.props.form.setFieldsValue(i({},e,100)),s([e],{force:!0})),a&&a<1&&(r.props.form.setFieldsValue(i({},e,1)),s([e],{force:!0})),l()}}],trigger:["onBlur","onChange"]}]})},validateTitle:function(e){var t=this.props.form.getFieldProps;return t(e,{validate:[{rules:[{required:!0,message:"请输入标题"},{max:32,message:"标题不能超过32个字"},{validator:function(e,t,a){t&&t.length<=32&&t.match(/^\s/)&&a(new Error("行首不能输入空格")),a()}}],trigger:["onBlur","onChange"]}]})},componentWillMount:function(){var e=this,t=g.default.queryString("appId",window.location.href);t&&e.props.form.setFieldsValue({appId:t})},changeCheckbox:function(e,t){this.setState({distinctId:e,distinctTitle:t})},clearUserGroup:function(){var e={};e.userGroupName=null,e.userGroupDesc=null,e.showSearch=!1,e.percentNum=0,window._userGroupName=null,window._userGroupDesc=null,this.setState(e),this.props.form.setFieldsValue({userGroupId:null})},changeRadio:function(e){var t={},a=e.target.name,s=e.target.value;t[a]=s,"userType"===a&&this.props.form.getFieldValue("userType")!==s&&(t.showSearch=!1,t.percentNum=0,t.pushReviewNumber="..."),"userGroupId"===a&&(t.userGroupName=e.target.label,t.userGroupDesc=e.target.expression,window._userGroupName=e.target.label,window._userGroupDesc=e.target.expression,this.state.userGroupId!==s&&(t.showSearch=!1,t.percentNum=0,t.pushReviewNumber="...")),"distinct"==a&&0==s&&(t.distinctTitle=[]),this.setState(t),this.props.form.setFieldsValue(t)},handleCancel:function(){this.setState({visible:!1,submiting:!1})},getAppName:function(e){var t="全部应用",a=p.default.allApp;if(a)for(var s=0;s<a.length;s++)a[s].appId==e&&(t=a[s].name);this.setState({appName:t})},componentWillReceiveProps:function(){var e=g.default.queryString("appId",window.location.href);this.state.appId&&e!==this.state.appId&&(this.getAppName(e),this.setState({showSearch:!1,pushReviewNumber:"...",percentNum:0,appId:e}),this.getAppInfo(),this.getBlackList(),this.getMaterial())},getAppInfo:function(e){var t=this,a=g.default.queryString("appId",window.location.href);m.default.get(c.default.getAppInfo+"?appId="+a,function(a){var s=a.value.appIconUrl;e&&e(s),e||(t.setState({noticeImgUrl:""===s?null:s}),t.props.form.setFieldsValue({noticeImgUrl:""===s?null:s})),t.setState({flymeAuth:a.value.flymeAuth,appName:a.value.appName,limitRate:a.value.limitRatem,msgCacheStatus:a.value.msgCache})})},componentWillUnmount:function(){document.querySelector("#personalPush")&&(document.querySelector("#personalPush").className=""),this.state.jumpUserGroup||(U.jsonData=null)},setUserTypeGroup:function(e){e=e.items;for(var t=e.length,a=g.default.queryString("id",window.location.href),s=0;s<t;s++)a==e[s].id&&(this.setState({userGroupName:e[s].name}),window._userGroupName=e[s].name,window._userGroupDesc=e[s].userGroupDesc)},componentDidMount:function(){var e=this;document.querySelector("#personalPush")&&(document.querySelector("#personalPush").className="active");var t=g.default.queryString("appId",window.location.href);this.setState({appId:t}),this.getBlackList();var a=g.default.queryString("deal",window.location.href),s=g.default.queryString("id",window.location.href);if(a&&U.jsonData){this.setState({userType:1,userGroupId:s}),U.jsonData.userType=1,U.jsonData.userGroupId=s;var i=[];for(var r in U.jsonData)if(r.indexOf("materialId")>-1&&U.jsonData[r]){var l=r.split("materialId")[1];i.push(parseInt(l))}U.jsonData.materialIds=i,e.setState(U.jsonData),e.props.form.setFieldsValue(U.jsonData)}else window.vedioFilePathJson={},window.smallImageFilePathJson={},window.bigImageFilePathJson={},e.props.form.setFieldsValue(this.state);this.getAppInfo(function(t){e.props.form.setFieldsValue({noticeImgUrl:t})}),this.getMaterial(),this.getListSceneTag()},changeSceneTag:function(e,t){var a={scheneTagsName:t.props.children};"null"!==e?a.scheneTagsId=Number(e):a.scheneTagsId=null,this.setState(a)},getListSceneTag:function(){var e=this,t=g.default.queryString("appId",window.location.href);m.default.post(c.default.listSceneTag,{appId:t},function(t){e.setState({listSceneTag:t.value})})},getMaterial:function(){var e=this,t=g.default.queryString("appId",window.location.href);m.default.post(c.default.listMaterial,{appId:t},function(t){e.setState({listMaterial:t.value})})},clickHide:function(e){1===e&&this.setState({noticeExpandContent:!1,toggleStatus:!1}),2===e&&this.setState({noticeExpandImgUrl:!1,showBigImg:!1,toggleStatus:!1})},onChangePushTime:function(e){var t=this.props.form.getFieldValue("fixEndDisplayTime"),a=this.props.form.getFieldValue("fixStartDisplayTime"),s=e>a?e:a,i=e>t?e:t;this.props.form.setFieldsValue({fixEndDisplayTime:i||e,fixStartDisplayTime:s||e})},validateData:function(e,a,s){var i=this,r=!1;"push"===a&&(r=!0),this.setState({percentRequire:r});var l=g.default.queryString("appId",window.location.href),n=this;this.props.form.validateFields(function(r,o){var u=o.userType;if("deal"===e)return o.noticeBarImgUrl||(o.noticeBarImgUrl=n.state.noticeBarImgUrl),o.noticeExpandImgUrl||(o.noticeExpandImgUrl=n.state.noticeExpandImgUrl),o.showAdvanceStatus=n.state.showAdvanceStatus,U.jsonData=o,void(t.jsonData=o);if("getUserNumber"===a)return void(s&&s(l,o));if(!(+new Date(o.fixStartDisplayTime)>+new Date(o.fixEndDisplayTime))){var p=n.state.materialIds;if(!p.length)return void n.setState({materialDisplay:!0});var d=n.state.distinctId;if(o.distinct&&0===d.length)return void n.setState({displayDistinct:""});for(var c in o)(c.indexOf("distinctId")>-1||c.indexOf("materialId")>-1)&&delete o[c];d&&(o.distinctId=d.join(","));var h=[];for(var m in o)if(m.indexOf("blackId")>-1&&o[m]){var f=m.split("blackId")[1];h.push(f),delete o[m]}if(o.blackId=h.join(","),(5!==u||o.tagIds)&&(1!==u||o.userGroupId&&"null"!==o.userGroupId)&&(o.target=o["target"+u],delete o["target"+u],o.userFilePath=o["userFilePath"+u],delete o["userFilePath"+u],""===o.target&&delete o.target,o.userFilePath&&delete o.target,"push"!==a||n.props.form.getFieldValue("pushPercent"))){if(r)return console.log(r),void console.log("Errors in form!!!");o.noticeBarInfo={title:o.title.trim()},n.delParams(o,o.noticeBarInfo),o.pushRuleInfo={pushMaterialId:p.join(",")};var v=i.state.scheneTagsId;if(v&&"null"!==v&&(o.pushRuleInfo.scheneTagId=v,o.pushRuleInfo.scheneTagName=i.state.scheneTagsName),n.delParams(o,o.pushRuleInfo),o.pushTimeInfo={pushTimeType:o.pushTimeType,startTime:o.startTime&&g.default.dateFormat("yyyy-MM-dd hh:mm:ss",o.startTime),offLine:o.offLine,validTime:o.validTime},n.delParams(o,o.pushTimeInfo),delete o.tagIdsName,o.userTypeInfo={userType:2===u?6:u,userGroupId:o.userGroupId,target:o.target,pushPercent:o.pushPercent,userFilePath:o.userFilePath},n.delParams(o,o.userTypeInfo),o.advanceInfo={blackId:o.blackId,black:o.black,distinct:o.distinct,distinctId:o.distinctId},n.delParams(o,o.advanceInfo),o.appId=l,o.advanceInfo.black&&""===o.advanceInfo.blackId)return void n.setState({showAdvanceStatus:!0});n.setState({requestData:o}),s&&s(l,o)}}})},getUserNumber:function(e){if(!this.state.searching){var t=this,a=t.props.form.validateFields;this.validateData(e,"getUserNumber",function(e,s){var i=s.userType;s.userTypeInfo={userType:2===i?6:i,userGroupId:s.userGroupId,target:s.target,pushPercent:s.pushPercent,userFilePath:s.userFilePath},t.delParams(s,s.userTypeInfo);var r=c.default.getPushCount,l={appId:e,userTypeInfo:s.userTypeInfo};r=g.default.makeUrl(r,{appId:e,pushType:0,json:JSON.stringify(l)}),t.setState({pushReviewNumber:"...",searching:!0,percentNum:0,showSearch:!0}),m.default.get(r,function(e){t.setState({pushReviewNumber:e.value,searching:!1}),a(["pushPercent"],{force:!0})},function(){t.setState({showSearch:!1,searching:!1})},{timeout:3e5})})}},handleSubmit:function(e,a){"deal"===a&&this.setState({jumpUserGroup:!0});var s=this;return"0"===this.state.pushReviewNumber?void o.message.error("预计推送人数为0，不可以创建推送任务"):void this.validateData(a,"push",function(e,i){return"deal"===a?(i.noticeBarImgUrl||(i.noticeBarImgUrl=s.state.noticeBarImgUrl),i.noticeExpandImgUrl||(i.noticeExpandImgUrl=s.state.noticeExpandImgUrl),i.showAdvanceStatus=s.state.showAdvanceStatus,U.jsonData=i,void(t.jsonData=i)):void s.setState({visible:!0})})},getBlackList:function(){var e=this,t=g.default.queryString("appId",window.location.href),a=g.default.queryString("taskId",window.location.href),s=c.default.pushTaskListBlack,i={appId:t};a&&(i.copyTaskId=a),m.default.post(s,i,function(t){var a=t.value,s={blackList:a};a.length?s.black=1:s.black=0,e.setState(s)})},changeMaterial:function(e){var t=e.target.data.materialId,a=e.target.checked,s=this.state.materialIds;a?s.push(t):s=s.filter(function(e){return e!==t});var i={materialIds:s};i.materialDisplay=!s.length,this.setState(i)},changeBlack:function(e){var t={blackList:e},a=e.filter(function(e){return e.choose});a.length?t.displayBlackList="none":t.displayBlackList="",this.setState(t)},render:function(){var e="notice",t=this,a=this.props.form.getFieldProps,s=this.state.listMaterial,i=U.jsonData,l=s.map(function(e,s){var l=!!i&&i["materialId"+e.materialId];return n.default.createElement(_,{className:"mg0",key:s},n.default.createElement("label",null,n.default.createElement(o.Checkbox,r({defaultChecked:l,data:e,title:e.title},a("materialId"+e.materialId,{onChange:function(e){t.changeMaterial(e,s)}}))),e.title,n.default.createElement("span",{className:"pl10"},"数量：",e.total)))});s.length||(l=n.default.createElement("span",{className:"color_error"},"无数据　"));var u=this.state.materialIds,p=s.filter(function(e){for(var t=0;t<u.length;t++)if(e.materialId===u[t])return!0;return!1}),d=this.state.listSceneTag,c=[n.default.createElement(R,{key:"null",value:"null"},"无")];return d.map(function(e,t){c.push(n.default.createElement(R,{key:t,value:String(e.fid)},e.fname))}),n.default.createElement(o.Form,{horizontal:!0,id:"detailTable"},n.default.createElement(o.Row,null,n.default.createElement(o.Col,{span:"15",className:""},n.default.createElement("div",null,n.default.createElement(_,r({},L,{label:"标题    "}),n.default.createElement(o.Input,r({placeholder:"请输入标题",style:{width:420}},this.validateTitle("title")))),n.default.createElement(_,r({className:"push_rule"},L,{label:"内容选择    "}),n.default.createElement("div",{className:"user_type "},l,this.state.materialDisplay&&n.default.createElement("span",{className:"color_error"},"请选择")))),n.default.createElement("div",null,n.default.createElement(b.default,{formItemLayout:L,getFieldProps:a,onChangePushTime:this.onChangePushTime,pushTimeStatus:this.state.endTimeStatus,pushTimeType:this.props.form.getFieldValue("pushTimeType"),changeRadio:this.changeRadio}),n.default.createElement(y.default,{form:this.props.form,offLine:this.state.offLine,formItemLayout:L,getFieldProps:a})),n.default.createElement(E.default,{form:this.props.form,formItemLayout:L,getFieldProps:a,scope:this.state.scope,userType:this.props.form.getFieldValue("userType"),handleSubmit:this.handleSubmit,personalPush:!0,clearUserGroup:this.clearUserGroup,userGroupId:this.state.userGroupId,type:e,setUserTypeGroup:this.setUserTypeGroup,flymeAuth:this.state.flymeAuth,appId:g.default.queryString("appId",window.location.href),changeRadio:this.changeRadio}),n.default.createElement(_,r({},L,{label:"推送场景    "}),n.default.createElement(o.Select,{style:{width:582},defaultValue:"null",onSelect:this.changeSceneTag},c)),n.default.createElement(N.default,{form:this.props.form,formItemLayout:L,appId:g.default.queryString("appId",window.location.href),getFieldProps:a,displayDistinct:this.state.displayDistinct,changeCheckbox:this.changeCheckbox,distinct:this.props.form.getFieldValue("distinct"),pushType:e,changeRadio:this.changeRadio}),n.default.createElement(_,r({},L,{label:" "}),n.default.createElement(o.Button,{type:"primary",style:{width:130},onClick:this.getUserNumber,size:"large"},"获取用户量"),n.default.createElement("span",{style:{paddingLeft:10,display:this.state.showSearch?"":"none"}}," ","..."===this.state.pushReviewNumber?n.default.createElement("span",null,"查询中"):n.default.createElement("span",null,"用户量")," ",this.state.pushReviewNumber)),n.default.createElement(_,r({},L,{label:"数量筛选    "}),n.default.createElement(o.Input,r({type:"number",min:1,max:100,placeholder:"请输入百分比值",className:this.state.percentRequire?this.props.form.getFieldValue("pushPercent")?"":"push_percent_input":"",style:{width:130}},this.validatePushPercent("pushPercent")))," %",n.default.createElement("span",{style:{paddingLeft:10,display:this.props.form.getFieldValue("pushPercent")&&this.state.percentNum&&"0"!=this.state.percentNum?"":"none"}},"用户量 ",this.state.percentNum),n.default.createElement("span",{style:{color:"#f50",display:this.state.percentRequire?this.props.form.getFieldValue("pushPercent")?"none":"":"none"}},"请输入百分比值")),n.default.createElement(D.default,{personalPush:!0,form:this.props.form,formItemLayout:L,getFieldProps:a,appId:g.default.queryString("appId",window.location.href),blackList:this.state.blackList,black:this.state.black,changeBlack:this.changeBlack,displayBlackList:this.state.displayBlackList,tableDataIndex:this.props.tableDataIndex,changeIcon:this.changeIcon,showAdvanceStatus:!0,changeRadio:this.changeRadio,type:this.props.pushType}))),n.default.createElement(o.Row,{className:"push_btn"},n.default.createElement(o.Col,{span:"14"},this.props.groupPush?null:n.default.createElement(_,{label:""},n.default.createElement(o.Button,{type:"primary",onClick:this.handleSubmit,size:"large"},"推送")))),this.props.groupPush?n.default.createElement(o.Row,null,n.default.createElement(o.Col,null,n.default.createElement(P.default,{submiting:this.props.submiting,handleOk:this.props.handleOk,type:e,groupPush:this.props.groupPush,form:this.props.form,handleSubmit:this.handleSubmit,addPushData:this.props.addPushData,requestData:this.state.requestData,handleCancel:this.props.handleCancel,visible:this.props.visible,pushReviewNumber:this.state.pushReviewNumber,popoverVisible:this.state.popoverVisible}))):null,n.default.createElement(S.default,{form:this.props.form,requestData:this.state.requestData,personalPush:!0,listMaterial:p,materialIds:this.state.materialIds,noticeImgUrl:this.state.noticeImgUrl||this.props.form.getFieldValue("noticeImgUrl"),visible:this.state.visible,userGroupName:window._userGroupName||this.state.userGroupName,userGroupDesc:window._userGroupDesc||this.state.userGroupDesc,handleOk:this.handleOk,appName:this.state.appName,listSceneTag:this.state.scheneTagsName,blackList:this.state.blackList,submiting:this.state.submiting,msgCache:this.state.msgCache,pushPercent:this.props.form.getFieldValue("pushPercent"),msgCacheStatus:this.state.msgCacheStatus,type:e,handleCancel:this.handleCancel,distinctTitle:this.state.distinctTitle,pushReviewNumber:this.state.pushReviewNumber}))}});B=o.Form.create()(B),e.exports=B}});